trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  jobs:
  - job: Build
    steps:
    - task: UseDotNet@2
      inputs:
        packageType: 'sdk'
        version: '5.x'
        installationPath: $(Agent.ToolsDirectory)/dotnet
    - script: 'dotnet build --configuration Release'
      displayName: 'Build project'

- stage: Deploy
  jobs:
  - job: Deploy
    environment: 'aks'
    steps:
    - task: Kubernetes@1
      inputs:
        connectionType: 'Azure Resource Manager'
        azureSubscription: '<Your-Azure-Subscription>'
        azureResourceGroup: 'myResourceGroup'
        kubernetesCluster: 'myAKSCluster'
        namespace: 'default'
        command: 'apply'
        useConfigurationFile: true
        configuration: 'manifests/deployment.yaml'
